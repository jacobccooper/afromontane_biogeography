---
title: "Hierarchical analyses of avian community biogeography in the Afromontane highlands"
author: "Jacob C. Cooper"
date: "9/17/2021"
output: html_document
---

# 1 Introduction

This exercise is designed to determine relationships between different Afromontane regions using different species lists and different taxonomic levels.

# 2 Setting up the code

I hide it here, but note that I declare my filepath for the rest of the document.

```{r,echo=F}
filepath="~/Dropbox/Manuscripts/Taxo-Phylo/"
setwd(filepath)
```

### Required *R* Packages:

```{r}
library(tidyverse)
library(ggplot2)
```

### Setting up the dataset:

Note here that I am reducing the presence-absence matrix down to the final presence-absence matrix used in the study (v2).

```{r}
x=as.data.frame(read_csv(paste0(filepath,"TableS1-Species_PAM_v2.csv")))
```

```{r}
summary(x)
```

```{r}
x.1=x[,1:9]
x.2=x[,-c(1:9)]

x.2[is.na(x.2)]=0

x=cbind(x.1,x.2)

colSums(x[,-c(1:9)])
```

```{r}
colnames(x)
```

```{r}
x2=x

# reformat names to be hierarchical

x2$Superspecies=paste(x2$Genus,x2$Superspecies)
x2$Species=paste(x2$Superspecies,x2$Species)
x2$Group=paste(x2$Species,x2$Group)
x2$Subspecies=paste(x2$Group,x2$Subspecies)
```

## 2.2 Remove Satellite Regions

For this iteration, I am going to remove satellite regions that can conflate analyses and group depauperate regions together.

```{r}
hist(colSums(x2[,10:ncol(x2)]),breaks = 15,
     main = "Histogram of Richness by Site",
     xlab = "Species richness")
```
There appears to be a mostly normal distribution with a tail of regions with fewer than 20 localities. Which localities are these?

```{r}
which(colSums(x2[,10:ncol(x2)])<34)
```

These are the regions that are often grouped together as the *satellite regions* clade. Thus, we are removing them to improve the clustering ability and to better analyze the regions with better represented communities (that are thus more inferrable for relationships). **Note**: I am making an exception for Gorongosa because this region was classifiable, despite its more limited species community. This was also the only point that would not be classified as a 'satellite' region.

Note the following sites were removed from a previous iteration based on lack of confidence in species' lists:

1. Mahenge
2. Mbulu

```{r}
x2=x2%>%select(-`Upper Guinea Highlands`,-`Monte Alen`,
               -Marungu,-Mahale,-`North Somali Mtns`,
               -Djibouti,-`Central African Plateau (Zambia)`,
               -`Rondo Plateau`,-Mayombe)

x2=x2[-which(rowSums(x2[,10:ncol(x2)])==0),]
# save alternate version without these localities
write_csv(x2,file = paste0(filepath,"TableS1_v2.csv"),col_names = T)
```

Now we need to reformat the metadata file as well.

```{r}
locs=colnames(x2[,-c(1:9)])

meta=read_csv(paste0(filepath,"locality_metadata.csv"))

meta2=meta[which(meta$Locality%in%locs),]

write_csv(meta2,file=paste0(filepath,"locality_metadata_v2.csv"))
```

# 3 Taxa overview

With the removal of the aforemention 'satellite' regions and other poorly sampled sites, we have the resulting number of species, with change denoted (if any). **These are the official numbers for this study**:

Source|Genus|Superspecies|Species|Group|Subspecies
------|-----|------------|-------|-----|----------
Dowsett (1986)|109|207 (-1)|261 (-5)|334 (-6)|532 (-20)
Bowie (2003)|123 (-1)|250 (-2)|309 (-6)|393 (-7)|627 (-27)
This study|130 (-2)|287 (-5)|350 (-9)|442 (-11)|725 (-39)